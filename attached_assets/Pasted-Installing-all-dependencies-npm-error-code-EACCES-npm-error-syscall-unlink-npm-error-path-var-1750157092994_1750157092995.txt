Installing all dependencies...
npm error code EACCES
npm error syscall unlink
npm error path /var/www/servicedesk/node_modules/.bin/cssesc
npm error errno -13
npm error [Error: EACCES: permission denied, unlink '/var/www/servicedesk/node_modules/.bin/cssesc'] {
npm error   errno: -13,
npm error   code: 'EACCES',
npm error   syscall: 'unlink',
npm error   path: '/var/www/servicedesk/node_modules/.bin/cssesc'
npm error }
npm error
npm error The operation was rejected by your operating system.
npm error It is likely you do not have the permissions to access this file as the current user
npm error
npm error If you believe this might be a permissions issue, please double-check the
npm error permissions of the file and its containing directories, or try running
npm error the command again as root/Administrator.
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.4.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.4.2
npm notice To update run: npm install -g npm@11.4.2
npm notice
npm error Log files were not written due to an error writing to the directory: /var/www/.npm/_logs
npm error You can rerun the command with `--loglevel=verbose` to see the logs in your terminal
Rebuilding application with proper bundling...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

sh: 1: vite: not found
Checking build output for external dependencies...
var __defProp = Object.defineProperty;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[__getOwnPropNames(fn)[0]])(fn = 0)), res;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};

// server/email-config.ts
var email_config_exports = {};
__export(email_config_exports, {
  getEmailConfig: () => getEmailConfig,
  isEmailConfigured: () => isEmailConfigured,
  updateEmailConfig: () => updateEmailConfig
});
function getEmailConfig() {
  return emailConfig;
}
Keeping all dependencies for now...
[Unit]
Description=Calpion IT Service Desk
After=network.target postgresql.service
Wants=network.target

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/var/www/servicedesk
Environment=NODE_ENV=production
Environment=PORT=5000
Environment=HOST=127.0.0.1
ExecStart=/usr/bin/npx tsx server/index.ts
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=servicedesk

# Security
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ReadWritePaths=/var/www/servicedesk/uploads

[Install]
WantedBy=multi-user.target
Waiting for service to start...
Checking service status...
‚óè servicedesk.service - Calpion IT Service Desk
     Loaded: loaded (/etc/systemd/system/servicedesk.service; enabled; vendor preset: enabled)
     Active: activating (auto-restart) (Result: exit-code) since Tue 2025-06-17 10:44:21 UTC; 3s ago
    Process: 21359 ExecStart=/usr/bin/npx tsx server/index.ts (code=exited, status=1/FAILURE)
   Main PID: 21359 (code=exited, status=1/FAILURE)
        CPU: 1.385s

Jun 17 10:44:21 ip-172-31-85-178 systemd[1]: servicedesk.service: Main process exited, code=exited, status=1/FAILURE
Jun 17 10:44:21 ip-172-31-85-178 systemd[1]: servicedesk.service: Failed with result 'exit-code'.
Jun 17 10:44:21 ip-172-31-85-178 systemd[1]: servicedesk.service: Consumed 1.385s CPU time.
Testing application response...
No response on port 5000

=== Service Management Commands ===
Status:  sudo systemctl status servicedesk
Logs:    sudo journalctl -fu servicedesk
Restart: sudo systemctl restart servicedesk

If still failing, check: sudo journalctl -fu servicedesk --no-pager -n 50
