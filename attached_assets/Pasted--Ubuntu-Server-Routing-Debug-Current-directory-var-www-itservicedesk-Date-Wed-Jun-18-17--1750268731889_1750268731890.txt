=== Ubuntu Server Routing Debug ===
Current directory: /var/www/itservicedesk
Date: Wed Jun 18 17:44:25 UTC 2025

1. Checking PM2 process status...
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ itservicedesk    │ default     │ 1.0.0   │ fork    │ 176413   │ 97s    │ 4    │ online    │ 0%       │ 60.6mb   │ ubuntu   │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘

2. Checking recent PM2 logs...
[TAILING] Tailing last 10 lines for [itservicedesk] process (change the value with --lines option)
/var/www/itservicedesk/logs/err-0.log last 10 lines:
0|itservic | 2025-06-18T17:36:19: Login error: Error: SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
0|itservic | 2025-06-18T17:36:19:     at /var/www/itservicedesk/node_modules/pg-pool/index.js:45:11
0|itservic | 2025-06-18T17:36:19:     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|itservic | 2025-06-18T17:36:19:     at async /var/www/itservicedesk/dist/production.cjs:70:20
0|itservic | 2025-06-18T17:40:08: Warning: connect.session() MemoryStore is not
0|itservic | 2025-06-18T17:40:08: designed for a production environment, as it will leak
0|itservic | 2025-06-18T17:40:08: memory, and will not scale past a single process.
0|itservic | 2025-06-18T17:42:48: Warning: connect.session() MemoryStore is not
0|itservic | 2025-06-18T17:42:48: designed for a production environment, as it will leak
0|itservic | 2025-06-18T17:42:48: memory, and will not scale past a single process.

/var/www/itservicedesk/logs/out-0.log last 10 lines:
0|itservic | 2025-06-18T17:42:48: Static path: /var/www/itservicedesk/dist/public
0|itservic | 2025-06-18T17:42:48: 🚀 Production server running on port 5000
0|itservic | 2025-06-18T17:42:48: 📁 Static files: /var/www/itservicedesk/dist/public
0|itservic | 2025-06-18T17:42:48: 🗄️  Database: servicedesk@localhost:5432
0|itservic | 2025-06-18T17:42:48: 🌐 Access: https://98.81.235.7
0|itservic | 2025-06-18T17:42:48: ✓ Database connected successfully
0|itservic | 2025-06-18T17:42:52: Login attempt for: admin
0|itservic | 2025-06-18T17:42:52: ✓ Login successful for: admin Role: admin
0|itservic | 2025-06-18T17:43:09: Login attempt for: admin
0|itservic | 2025-06-18T17:43:09: ✓ Login successful for: admin Role: admin

^C

3. Checking file structure...
dist/ contents:
total 176
drwxrwxr-x  3 ubuntu ubuntu   4096 Jun 18 17:19 .
drwxr-xr-x 11 ubuntu ubuntu   4096 Jun 18 17:42 ..
-rw-rw-r--  1 ubuntu ubuntu 158185 Jun 18 17:42 index.js
-rw-rw-r--  1 ubuntu ubuntu   7856 Jun 18 17:42 production.cjs
drwxrwxr-x  3 ubuntu ubuntu   4096 Jun 18 17:42 public

dist/public/ contents:
total 80
drwxrwxr-x 3 ubuntu ubuntu  4096 Jun 18 17:42 .
drwxrwxr-x 3 ubuntu ubuntu  4096 Jun 18 17:19 ..
drwxrwxr-x 2 ubuntu ubuntu  4096 Jun 18 17:42 assets
-rw-rw-r-- 1 ubuntu ubuntu 62915 Jun 18 17:42 calpion-logo.png
-rw-rw-r-- 1 ubuntu ubuntu   625 Jun 18 17:42 index.html

4. Testing server responses...
Health check:
{"status":"OK","timestamp":"2025-06-18T17:45:16.983Z","staticPath":"/var/www/itservicedesk/dist/public","database":"connected"}
Root path test:
HTTP/1.1 200 OK
X-Powered-By: Express
Cache-Control: no-cache
Accept-Ranges: bytes
Last-Modified: Wed, 18 Jun 2025 17:42:43 GMT

5. Testing authentication flow...
Login test:
{"user":{"id":1,"username":"admin","email":"admin@calpion.com","role":"admin","name":"System Administrator"}}

Session test:
{"user":{"id":1,"username":"admin","email":"admin@calpion.com","role":"admin","name":"System Administrator"}}
6. Testing static file serving...
Checking for index.html:
HTTP/1.1 200 OK
X-Powered-By: Express
Cache-Control: no-cache

7. Checking nginx status and config...
● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2025-06-18 17:19:08 UTC; 26min ago
       Docs: man:nginx(8)
   Main PID: 173318 (nginx)
      Tasks: 2 (limit: 1129)
     Memory: 4.2M
        CPU: 78ms
     CGroup: /system.slice/nginx.service
             ├─173318 "nginx: master process /usr/sbin/nginx -g daemon on; master_process on;"
             └─173319 "nginx: worker process" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""

Jun 18 17:19:08 ip-172-31-85-178 systemd[1]: Starting A high performance web server and a reverse proxy server...
Jun 18 17:19:08 ip-172-31-85-178 systemd[1]: Started A high performance web server and a reverse proxy server.

Nginx config for IT Service Desk:
No nginx config found

8. Checking port 5000 connectivity...
Command 'netstat' not found, but can be installed with:
sudo apt install net-tools

9. Testing direct HTTPS access...
HTTP/2 200
server: nginx/1.18.0 (Ubuntu)
date: Wed, 18 Jun 2025 17:45:17 GMT

=== Debug Complete ===
