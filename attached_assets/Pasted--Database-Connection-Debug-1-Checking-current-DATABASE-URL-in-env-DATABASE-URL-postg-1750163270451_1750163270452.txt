=== Database Connection Debug ===

1. Checking current DATABASE_URL in .env...
DATABASE_URL=postgresql://servicedesk:servicedesk_password_2024@localhost:5432/servicedesk

2. Testing what the application actually connects to...
DATABASE_URL: postgresql://servicedesk:servicedesk_password_2024@localhost:5432/servicedesk

3. Testing connection with the exact URL from .env...
 current_user | current_database | session_user
--------------+------------------+--------------
 servicedesk  | servicedesk      | servicedesk
(1 row)


4. Checking what user owns the tables...
 schemaname |    tablename     | tableowner
------------+------------------+-------------
 public     | approval_routing | servicedesk
 public     | attachments      | servicedesk
 public     | change_approvals | servicedesk
 public     | change_history   | servicedesk
 public     | changes          | servicedesk
 public     | products         | servicedesk
 public     | sessions         | servicedesk
 public     | ticket_history   | servicedesk
 public     | tickets          | servicedesk
 public     | users            | servicedesk
(10 rows)


5. Stopping service and manually fixing DATABASE_URL...
DATABASE_URL=postgresql://servicedesk:servicedesk_password_2024@localhost:5432/servicedesk

6. Verifying updated .env...
DATABASE_URL=postgresql://servicedesk:servicedesk_password_2024@localhost:5432/servicedesk

7. Testing connection with corrected URL...
 current_user | current_database
--------------+------------------
 servicedesk  | servicedesk
(1 row)


8. Ensuring all tables exist and have correct ownership...
 schemaname |    tablename     | tableowner
------------+------------------+-------------
 public     | changes          | servicedesk
 public     | change_history   | servicedesk
 public     | ticket_history   | servicedesk
 public     | change_approvals | servicedesk
 public     | attachments      | servicedesk
 public     | sessions         | servicedesk
 public     | products         | servicedesk
 public     | approval_routing | servicedesk
 public     | users            | servicedesk
 public     | tickets          | servicedesk
(10 rows)

DO
 schemaname |    tablename     | tableowner
------------+------------------+-------------
 public     | changes          | servicedesk
 public     | change_history   | servicedesk
 public     | ticket_history   | servicedesk
 public     | change_approvals | servicedesk
 public     | attachments      | servicedesk
 public     | sessions         | servicedesk
 public     | products         | servicedesk
 public     | approval_routing | servicedesk
 public     | users            | servicedesk
 public     | tickets          | servicedesk
(10 rows)


9. Testing table access after ownership fix...
 table_name | count
------------+-------
 tickets    |     0
 changes    |     0
 users      |     0
(3 rows)


10. Starting service with corrected configuration...

11. Monitoring for permission errors...
Jun 17 12:27:35 ip-172-31-85-178 servicedesk[25507]: 12:27:35 PM [express] Warning: Failed to warm up database connection
Jun 17 12:27:35 ip-172-31-85-178 servicedesk[25507]: 12:27:35 PM [express] HTTP server running on port 5000 (host: 0.0.0.0)
Jun 17 12:27:35 ip-172-31-85-178 servicedesk[25507]: 12:27:35 PM [express] [OVERDUE] Error during overdue check process: error: permission denied for table changes
Jun 17 12:27:35 ip-172-31-85-178 servicedesk[25507]: 12:27:35 PM [express] [AUTO-CLOSE] Error during auto-close process: error: permission denied for table tickets
