
1. Stopping all database activity...

2. Creating nuclear permission reset...
You are now connected to database "servicedesk" as user "postgres".
ALTER ROLE
ALTER DATABASE
ALTER SCHEMA
ALTER DEFAULT PRIVILEGES
ALTER DEFAULT PRIVILEGES
GRANT
GRANT
DO
ALTER DEFAULT PRIVILEGES
ALTER DEFAULT PRIVILEGES
ALTER DEFAULT PRIVILEGES
ALTER DEFAULT PRIVILEGES
 tablename | tableowner  | select_perm | update_perm | insert_perm | delete_perm
-----------+-------------+-------------+-------------+-------------+-------------
 changes   | servicedesk | t           | t           | t           | t
 tickets   | servicedesk | t           | t           | t           | t
 users     | servicedesk | t           | t           | t           | t
(3 rows)


3. Testing permissions with exact same connection as app...
Testing SELECT permissions:
 table_name | count
------------+-------
 tickets    |     0
 changes    |     0
 users      |     0
(3 rows)


Testing INSERT/UPDATE permissions:
BEGIN
ERROR:  column "password_hash" of relation "users" does not exist
LINE 1: INSERT INTO users (username, email, password_hash, role) VAL...
                                            ^
ERROR:  current transaction is aborted, commands ignored until end of transaction block
ERROR:  current transaction is aborted, commands ignored until end of transaction block
ROLLBACK

4. Updating database connection to use superuser privileges...
DATABASE_URL=postgresql://servicedesk:servicedesk_password_2024@localhost:5432/servicedesk

5. Testing Node.js database access...
-bash: final_test.js: Permission denied
node:internal/modules/cjs/loader:1215
  throw err;
  ^

Error: Cannot find module '/var/www/servicedesk/final_test.js'
    at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
    at Module._load (node:internal/modules/cjs/loader:1043:27)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
    at node:internal/main/run_main_module:28:49 {
  code: 'MODULE_NOT_FOUND',
  requireStack: []
}

Node.js v20.19.2
rm: cannot remove 'final_test.js': No such file or directory

6. Starting service with superuser database access...

7. Final monitoring...
Jun 17 12:31:56 ip-172-31-85-178 servicedesk[25746]: 12:31:56 PM [express] Warning: Failed to warm up database connection
Jun 17 12:31:56 ip-172-31-85-178 servicedesk[25746]: 12:31:56 PM [express] HTTP server running on port 5000 (host: 0.0.0.0)
Jun 17 12:31:56 ip-172-31-85-178 servicedesk[25746]: 12:31:56 PM [express] [OVERDUE] Error during overdue check process: error: permission denied for table changes
Jun 17 12:31:56 ip-172-31-85-178 servicedesk[25746]: 12:31:56 PM [express] [AUTO-CLOSE] Error during auto-close process: error: permission denied for table tickets

=== Final Database Solution Complete ===
