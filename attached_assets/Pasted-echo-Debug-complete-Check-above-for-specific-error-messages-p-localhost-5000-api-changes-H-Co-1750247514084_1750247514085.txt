echo "Debug complete. Check above for specific error messages."p://localhost:5000/api/changes -H "Content-Type: application/json" -d '{"title":"Test Change",
Debugging production database issues...
1. Testing database connection:
                                                                version
----------------------------------------------------------------------------------------------------------------------------------------
 PostgreSQL 14.18 (Ubuntu 14.18-0ubuntu0.22.04.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, 64-bit
(1 row)

2. Checking database and user:
   datname
-------------
 servicedesk
(1 row)

   usename
-------------
 servicedesk
(1 row)

3. Checking existing tables:
                List of relations
 Schema |       Name       | Type  |    Owner
--------+------------------+-------+-------------
 public | approval_routing | table | servicedesk
 public | attachments      | table | servicedesk
 public | change_approvals | table | servicedesk
 public | change_history   | table | servicedesk
 public | changes          | table | servicedesk
 public | products         | table | servicedesk
 public | sessions         | table | servicedesk
 public | settings         | table | servicedesk
 public | ticket_history   | table | servicedesk
 public | tickets          | table | servicedesk
 public | users            | table | servicedesk
(11 rows)

4. Checking settings table:
 id | key | value | description | created_at | updated_at
----+-----+-------+-------------+------------+------------
(0 rows)

5. Checking changes table:
                                                Table "public.changes"
          Column           |            Type             | Collation | Nullable |               Default
---------------------------+-----------------------------+-----------+----------+-------------------------------------
 id                        | integer                     |           | not null | nextval('changes_id_seq'::regclass)
 title                     | text                        |           | not null |
 description               | text                        |           | not null |
 status                    | character varying(20)       |           | not null |
 priority                  | character varying(20)       |           | not null |
 category                  | character varying(50)       |           | not null |
 product                   | character varying(100)      |           |          |
 requested_by              | text                        |           | not null |
 approved_by               | text                        |           |          |
 implemented_by            | text                        |           |          |
 planned_date              | timestamp without time zone |           |          |
 completed_date            | timestamp without time zone |           |          |
 start_date                | timestamp without time zone |           |          |
 end_date                  | timestamp without time zone |           |          |
 risk_level                | character varying(20)       |           | not null |
 change_type               | character varying(20)       |           | not null | 'normal'::character varying
 rollback_plan             | text                        |           |          |
 approval_token            | text                        |           |          |
 overdue_notification_sent | timestamp without time zone |           |          |
 is_overdue                | character varying(10)       |           |          | 'false'::character varying
 created_at                | timestamp without time zone |           | not null | now()
 updated_at                | timestamp without time zone |           | not null | now()
Indexes:
    "changes_pkey" PRIMARY KEY, btree (id)
Referenced by:
    TABLE "attachments" CONSTRAINT "attachments_change_id_changes_id_fk" FOREIGN KEY (change_id) REFERENCES changes(id)
    TABLE "change_approvals" CONSTRAINT "change_approvals_change_id_changes_id_fk" FOREIGN KEY (change_id) REFERENCES changes(id)
    TABLE "change_history" CONSTRAINT "change_history_change_id_changes_id_fk" FOREIGN KEY (change_id) REFERENCES changes(id)

6. Testing app database connection:
 current_user | current_database
--------------+------------------
 servicedesk  | servicedesk
(1 row)

7. Recent PM2 logs:
[TAILING] Tailing last 20 lines for [servicedesk] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/servicedesk-out-0.log last 20 lines:
0|serviced |   description: 'Testing active by default',
0|serviced |   category: 'software',
0|serviced |   owner: undefined
0|serviced | }
0|serviced | Product created successfully with isActive: true
0|serviced | Complete production server - all development features working
0|serviced | Creating product as ACTIVE: {
0|serviced |   name: 'Final Test Product',
0|serviced |   description: 'Complete deployment test',
0|serviced |   category: 'software',
0|serviced |   owner: undefined
0|serviced | }
0|serviced | Product created with isActive: true
0|serviced | Creating product as ACTIVE: { name: 'Test', description: '', category: '', owner: undefined }
0|serviced | Product created with isActive: true
0|serviced | Production server using development structure on port 5000
0|serviced | Complete production server with ALL endpoints running on port 5000
0|serviced | Complete production server with ALL endpoints running on port 5000
0|serviced | Complete production server with ALL endpoints running on port 5000
0|serviced | Email configuration endpoints fixed - admin console will now work

/home/ubuntu/.pm2/logs/servicedesk-error-0.log last 20 lines:
0|serviced |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|serviced |     at async /var/www/itservicedesk/complete-production-server.cjs:735:9 {
0|serviced |   length: 129,
0|serviced |   severity: 'ERROR',
0|serviced |   code: '42703',
0|serviced |   detail: undefined,
0|serviced |   hint: undefined,
0|serviced |   position: '41',
0|serviced |   internalPosition: undefined,
0|serviced |   internalQuery: undefined,
0|serviced |   where: undefined,
0|serviced |   schema: undefined,
0|serviced |   table: undefined,
0|serviced |   column: undefined,
0|serviced |   dataType: undefined,
0|serviced |   constraint: undefined,
0|serviced |   file: 'parse_target.c',
0|serviced |   line: '1075',
0|serviced |   routine: 'checkInsertTargets'
0|serviced | }

8. Testing API endpoints:
Login response: {"user":{"id":1,"username":"john.doe","email":"john.doe@company.com","role":"admin","name":"John Doe","assigned_products":null,"created_at":"2025-06-18T08:01:36.149Z"}}
Email settings response: {"message":"Failed to fetch email settings"}
Email save response: {"message":"Failed to update email settings"}
Change creation response: {"message":"Failed to create change"}
Debug complete. Check above for specific error messages.
